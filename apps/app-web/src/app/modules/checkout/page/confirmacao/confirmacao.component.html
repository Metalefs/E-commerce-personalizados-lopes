<ng-container *ngIf="(Orcamento$ |async)?.Produto.length > 0 then pedido else vazio"></ng-container>
<ng-template #vazio>

  <div class="margin a-i-c flex-m m-lr-auto has-text-center w-full">
    <figure class="image has-ratio">
      <img src="/assets/images/figures/undraw_empty_cart_co35.svg">

    </figure>
    <div class="">
      <h2 class="subtitle mb-0 pt-0">Seu carrinho está vazio</h2>
      <span class="subtitle">Clique abaixo para voltar e adicionar produtos ao seu orçamento</span>
      <div>
        <a pageScroll href="#TOPO" [routerLink]="['/produtos/']" routerLinkActive="router-link-active">
          <button mat-stroked-button mat-stroked-button class="button is-dark">
            Ver produtos
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
        </a>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #pedido>

  <section @fadeIn class="section py-0 px-0">
    <div *ngIf="edit" class="has-text-left">
      <h2 class="subtitle">Confira o seu pedido</h2>
      <span class="subtitle is-size-7">Revise seus produtos e continue para inserir seus dados pessoais.</span>
    </div>
    <div class="a-i-c">

      <div class="box border w-full px-2 of-x-scroll">

        <table mat-table [dataSource]="dataSource" class="w-full">

          <ng-container matColumnDef="Produtos">
            <th @fadeIn mat-header-cell *matHeaderCellDef> Produtos </th>
            <td @fadeIn mat-cell *matCellDef="let element">
              <div @fadeIn class="columns a-i-c mt-3">
                <div class="column flex-m">
                  <figure class="image is-64x64">
                    <img src="{{element?.Produto.Imagem[0]}}">
                  </figure>
                  <figure class="image is-64x64 d-block ">
                    <ng-container *ngIf="element?.Produto.Arte then arte else novaArte"></ng-container>
                    <ng-template #arte>

                      <figure class="image is-64x64 is-pri-image">
                        <img src="{{element?.Produto.Arte || ''}}" class="">
                      </figure>

                      <figure *ngIf="element?.Produto.ArteSecundaria" class="image is-64x64 is-sec-image">
                        <img src="{{element?.Produto.ArteSecundaria}}">
                      </figure>
                    </ng-template>
                    <ng-template #novaArte>
                      <div class="px-2 txt-center">
                        <em>Sem Arte</em>
                        <label class="file-label">
                          <input class="file-input" type="file" (change)="upload($event,element)">
                          <span class="file-cta">
                            <span class="file-icon">
                              <i class="pi pi-cloud-upload"></i>
                            </span>
                          </span>
                        </label>
                      </div>
                    </ng-template>
                  </figure>
                  <div class="is-hidden-desktop">
                    <a href="#topo" [routerLink]="['/produtos/'+element?.Produto._id+'/'+element?.codOrcamento]"
                      routerLinkActive="router-link-active"
                      class="px-3 titulo-produto ">{{element?.Produto.Nome}}
                      <p class="titulo-produto">{{element?.Produto.Cor?.nome}}</p>
                      <ng-container *ngIf="element?.Produto?.Tamanho">
                        <p class="subtitle">{{element?.Produto?.Tamanho}}</p>
                      </ng-container>
                    </a>

                    <ng-container *ngIf="!element?.Produto?.Tamanho">
                      <mat-form-field class=" " appearance="fill">
                        <mat-label>Tamanho:</mat-label>
                        <mat-select matNativeControl [(ngModel)]="element.Produto.Tamanho"
                          [value]="element.Produto.Tamanho">
                          <mat-option *ngFor="let opt of element.Produto.Tamanhos" [value]="opt" class="w-full">
                            <div class="" (click)="SetarTamanho(element, opt)">
                              <p>{{opt}}</p>
                            </div>
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </ng-container>

                  </div>
                </div>
                <div class="column is-hidden-touch">
                  <a href="#topo" [routerLink]="['/produtos/'+element?.Produto._id+'/'+element?.codOrcamento]"
                    routerLinkActive="router-link-active"
                    class="titulo-produto ">{{element?.Produto.Nome}}
                    <p class="subtitle">{{element?.Produto.Cor?.nome}}</p>
                    <ng-container *ngIf="element?.Produto?.Tamanho">
                      <p class="subtitle">{{element?.Produto?.Tamanho}}</p>
                    </ng-container>
                  </a>
                  <ng-container *ngIf="!element?.Produto?.Tamanho">
                    <mat-form-field class=" " appearance="fill">
                      <mat-label>Tamanho:</mat-label>
                      <mat-select matNativeControl [(ngModel)]="element.Produto.Tamanho"
                        [value]="element.Produto.Tamanho">
                        <mat-option *ngFor="let opt of element.Produto.Tamanhos" [value]="opt" class="w-full">
                          <div class="w-full" (click)="SetarTamanho(element, opt)">
                            <p>{{opt}}</p>
                          </div>
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </ng-container>
                <div>
                  <button *ngIf="edit" (click)="removerProduto(element)">
                    remover
                  </button>
                </div>

                </div>
              </div>
              <div class="columns is-mobile is-hidden-desktop mb-2">
                <div class="column is-9">
                  <div class="control is-small">
                    <button *ngIf="edit" mat-icon-button (click)="DecrescerQuantidade(element)">
                      <mat-icon class="less">remove</mat-icon>
                    </button>
                    <input placeholder="{{element?.Produto.QuantidadeMinima}}"
                      value="{{element?.Produto.QuantidadeMinima}}" type="number"
                      (change)="VerificarQuantidade($event,element)"
                      min="{{element?.Produto.QuantidadeMinima==0?1:element?.Produto.QuantidadeMinima}}"
                      class="quantidade-produto is-rounded" [(ngModel)]="(element).Produto.Quantidade">
                    <button *ngIf="edit" mat-icon-button (click)="IncrementarQuantidade(element)">
                      <mat-icon class="more">add</mat-icon>
                    </button>
                  </div>
                </div>
                <div class="column">
                  <span class="preco">R$ {{CalcularPreco(element)}}</span>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="Quantidade" class="is-hidden-touch">
            <th mat-header-cell *matHeaderCellDef class="is-hidden-touch"> qtd </th>
            <td @fadeIn mat-cell *matCellDef="let element" class="is-hidden-touch">
              <div class="control is-small ">
                <button *ngIf="edit" mat-icon-button (click)="DecrescerQuantidade(element)">
                  <mat-icon class="less">remove</mat-icon>
                </button>
                <input placeholder="{{element?.Produto.QuantidadeMinima}}" value="{{element?.Produto.QuantidadeMinima}}"
                  type="number" (change)="VerificarQuantidade($event,element)"
                  min="{{element?.Produto.QuantidadeMinima}}" class="quantidade-produto is-rounded"
                  [(ngModel)]="(element).Produto.Quantidade">
                <button *ngIf="edit" mat-icon-button (click)="IncrementarQuantidade(element)">
                  <mat-icon class="more">add</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="Subtotal" class="is-hidden-touch">
            <th mat-header-cell *matHeaderCellDef class="is-hidden-touch"> Subtotal</th>
            <td mat-cell *matCellDef="let element" class="is-hidden-touch">
              <span class="preco">R$ <span>{{CalcularPreco(element)}}</span></span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="ProdutoTable.displayedColumns"></tr>
          <tr @slideInOut mat-row *matRowDef="let row; columns: ProdutoTable.displayedColumns;"></tr>
        </table>
        <div class="w-full pt-3">
          <div class="columns">
            <div class="column"></div>
            <div class="column"></div>
            <div class="column has-text-right">
              <p class="titulo-produto px-3">Total: <span class="preco">R${{(Orcamento$|async)?.Preco.toFixed(2) ||
                  ''}}</span></p>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="edit" class="w-full">
        <a href="#topo" class="py-3" [routerLink]="['/produtos/']" routerLinkActive="router-link-active">
          <button class="py-3 pb-3 subtitle w-full">
            Escolher
            mais
            produtos
          </button>
        </a>
        <button [routerLink]="['/checkout/dados/']" [disabled]="!checkoutService.getValid()" pageScroll href="#TOPO"
          routerLinkActive="router-link-active" class="button is-success w-full"><span
            class="nunitoParagraphy16 has-text-white">Finalizar orçamento</span></button>
      </div>
    </div>

  </section>
</ng-template>
