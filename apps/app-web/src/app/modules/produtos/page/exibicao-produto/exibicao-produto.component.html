<div class=" has-background-white-bis bbr mb-3">
  <p-breadcrumb [styleClass]=" ''" *ngIf="this.Produto" [model]="items" [home]="home"></p-breadcrumb>
  <p-skeleton *ngIf="!Produto" styleClass="skeleton p-breadcrumb breadcrumb my-3 py-3"></p-skeleton>
</div>
<div class=" px-3 bbr pt-2">
  <div class="bbr ">
    <div class=" card pr-3 pl-2 has-background-white-bis bbr mb-3">
      <div class="columns reverse-col-mobile mt-3 bbr  " id="PRODUTO">

        <div class="column is-7 has-background-white bbr">

          <div class="mb-0 pb-0">

            <div class="pb-0" *ngIf="!Produto">
              <div class="p-grid p-formgrid">
                <div class="p-field p-col-12 p-md-6">
                  <p-skeleton styleClass="mb-2 pb-2"></p-skeleton>
                  <p-skeleton width="10rem" styleClass="mb-2 pb-2"></p-skeleton>
                  <p-skeleton width="5rem" styleClass="mb-2 pb-2"></p-skeleton>
                  <p-skeleton height="2rem" styleClass="mb-2 pb-2"></p-skeleton>
                  <p-skeleton width="10rem" height="4rem"></p-skeleton>
                </div>
              </div>
            </div>

            <div class="txt-right">
              <div class="txt-right" *ngIf="Produto">
                <div class="txt-right my-1 star-width dis-flex flex-w w-full">
                  <span class="spacer"></span>
                  <star-rating [ngClass]="loading ? 'button is-loading':''" class="subtitle is-size-7"
                    labelText="{{meanRating()}}" [showHalfStars]="true" [step]="0.5" size="medium" [rating]="meanRating()"
                    staticColor="ok" (starClickChange)="onClick($event)" (ratingChange)="onRatingChange($event)"
                    (hoverRatingChange)="onHoverRatingChange($event)" [hoverEnabled]="true" [starType]="'svg'">
                  </star-rating>
                  <span class="subtitle is-size-7">({{Produto?.Rating.length}} avaliações)</span>

                </div>
                <h1 class="titulo-produto">{{Produto?.Nome}}</h1>
                <span class="type-meta">
                  <i class="pi pi-tag"></i>
                  <a href="#" *ngFor="let tag of Produto?.Tags">{{tag}}, </a>
                </span>

                <ul class="list-unstyled">
                  <li>Modelo: <span>{{Produto?.Modelo || ''}}</span></li>
                  <li>Marca: <span>{{Produto?.Marca || ''}}</span></li>
                  <li>Disponibilidade: <span>{{translateStatusProduto(Produto?.Status)}} - Sob orçamento</span></li>
                </ul>

                <!-- <div class="descricao-produto w-full is-hidden-desktop" style="border-left: 1px solid #0000000a;"
                  [innerHTML]="Produto?.Especificacoes || 'Este produto está sem especificações'"></div> -->
                <span class="has-text-grey-light" *ngIf="Produto?.QuantidadeMinima > 1">
                  <em>
                    *Minimo {{Produto?.QuantidadeMinima}} unidades
                  </em>
                </span>

              </div>
              <div class="columns txt-left is-multiline is-vcentered pr-3">
                <div class="column pr-0">
                  <div class="w-full pt-3 mb-0">
                    <p class="is-size-7 pt-2"><span class="is-size-7 pt-2">Selecione a quantidade</span></p>
                    <div class="field pb-0 mb-0">
                      <div class="control border is-large flex-c flex-m ">
                        <button mat-icon-button (click)="DecrescerQuantidade()">
                          <mat-icon class="less">remove</mat-icon>
                        </button>
                        <input *ngIf="Produto" placeholder="{{Produto?.QuantidadeMinima}}"
                          value="{{Produto?.QuantidadeMinima <= 1 ? 1 : Produto?.QuantidadeMinima}}" type="number" (change)="VerificarQuantidade($event)"
                          min="{{Produto?.QuantidadeMinima <= 1 ? 1 : Produto?.QuantidadeMinima}}" class="quantidade-produto input"
                          [(ngModel)]="(Produto).Quantidade">
                        <button mat-icon-button (click)="IncrementarQuantidade()">
                          <mat-icon class="more">add</mat-icon>
                        </button>
                      </div>
                    </div>
                    <div class="columns txt-left is-vcentered pt-0 is-multiline">

                      <div class="column is-12  mb-5 py-0 pt-1">
                        <p class="is-size-7 pt-2"><span class="is-size-7 pt-2">Selecione:</span><strong>{{Produto?.Cor?.nome}}</strong></p>
                        <div class="columns px-3 mt-3 is-multiline dis-flex flex-sb" *ngIf="Produto?.Cores">
                          <div id="column pt-1 is-3" *ngFor="let cor of Produto?.Cores; let i =index">
                            <input class="px-2 py-2 mx-1" (click)="Produto.Cor=cor;"
                              [ngClass]="{'selected':Produto?.Cor?.nome == cor.nome}" type="radio" alt="{{cor.nome}}"
                              id="cor{{i}}" class="mx-1">
                            <label title="{{cor.nome}}" [style.background]="cor.cor"
                              [ngClass]="{'selected':Produto?.Cor?.nome == cor.nome}" (click)="Produto.Cor=cor;"
                              for="cor{{i}}"></label>
                            <span (click)="Produto.Cor=cor;"></span>
                          </div>
                        </div>
                      </div>
                      <div class="column is-12 py-0" *ngIf="Produto?.Tamanhos">
                        <!-- <p><span>Tamanhos</span></p> -->
                        <mat-form-field class="w-full" *ngIf="Produto?.Cores" appearance="fill">
                          <mat-label>Tamanho</mat-label>
                          <mat-select matNativeControl [(ngModel)]="Produto.Tamanho" [value]="Produto?.Tamanho">
                            <mat-option *ngFor="let opt of Produto?.Tamanhos" [value]="opt" class="w-full">
                              <div class="cor-produto card box w-full" (click)="Produto.Tamanho = opt">
                                <p>{{opt}}</p>
                              </div>
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>

                  </div>
                  <div *ngIf="Produto?.Status != statusProduto.esgotado" class="txt-left ">
                    <div class="columns">

                      <div class="mx-2 py-2 column is-7">
                        <ng-container *ngIf="Produto?.Status == statusProduto.promocao then preco_promo else preco_normal">
                        </ng-container>
                        <ng-template #preco_promo>
                          <div class="txt-left">
                            <p class="preco linethr">R$ {{Produto?.Preco.toFixed(2) || '0.00'}}</p>
                            <p class="preco promocao ">R$ {{Produto?.PrecoPromocional.toFixed(2) || '0.00'}}</p>
                          </div>
                        </ng-template>
                        <ng-template #preco_normal>
                          <div class="txt-left">
                            <p class="preco ">R$ {{Produto?.Preco.toFixed(2) || '0.00'}}</p>
                          </div>
                        </ng-template>
                        <div class="my-1" *ngIf="Produto?.Parcelas && Produto?.Parcelas > 0">
                          <p class="">
                            Em até {{Produto?.Parcelas}}x <span
                              class="preco-produto"><b>R${{((Produto?.Status == statusProduto.promocao ? Produto.PrecoPromocional : Produto.Preco) / Produto?.Parcelas).toFixed(2)}}</b></span>
                            sem juros
                          </p>
                        </div>
                      </div>
                      <div class="dis-flex flex-w column">
                        <button @fadeIn *ngIf="Produto" mat-raised-button
                          [disabled]="Produto?.Status == statusProduto.esgotado" (click)="AdicionarAoOrcamento()"
                          class="share-button wp-btn border-light w-full flex-m flex-c px-2 mx-2 has-text-white has-text-weight-bold">
                          {{textoAdicionar}}
                          <mat-icon>shopping_bag</mat-icon>
                        </button>
                      </div>
                    </div>
                    <div class="dis-flex flex-w column">
                      <button @fadeIn *ngIf="Produto" mat-raised-button
                        [disabled]="Produto?.Status == statusProduto.esgotado" (click)="AdicionarAoOrcamento()"
                        class="share-button border-light w-full has-background-dark flex-m flex-c px-2 mx-2 has-text-white has-text-weight-bold">
                        Personalizar
                      </button>
                      <!-- <button @fadeIn *ngIf="Produto" mat-raised-button
                        [disabled]="Produto?.Status == statusProduto.esgotado" (click)="AbrirModalArte()"
                        class="share-button button is-dark border-light flex-m flex-c px-2 mx-2 has-text-white has-text-weight-bold">
                        Personalizar
                      </button> -->
                    </div>

                    <mat-list *ngIf="!IsValid" class="px-2 mx-2 box border">
                      <mat-list-item *ngFor="let erro of Erros">
                        <p class="subtitle is-size-6 border">*{{erro.erro}}</p><hr>
                      </mat-list-item>
                    </mat-list>
                    <p-skeleton @fadeIn *ngIf="!Produto" height="32" width="100%" class=" w-full flex-m flex-c mx-2">
                    </p-skeleton>
                  </div>
                  <div *ngIf="Produto?.Status == statusProduto.esgotado" class="box pt-5 w-full">
                    <personalizados-lopes-botao-esgotado [Produto]="Produto"></personalizados-lopes-botao-esgotado>
                  </div>
                </div>
                <div class="column" *ngIf="this.isOrcamento">
                  <button mat-flat-button title="Criar novo pedido"
                    [disabled]="Produto?.Status == statusProduto.esgotado || !Produto?.Cor ||  !Produto?.Tamanho"
                    (click)="DuplicarOrcamento()" color="accent"
                    class="background-light-red mx-2 has-text-white has-text-weight-medium bo-cir">
                    Novo
                    <mat-icon>add</mat-icon>
                  </button>
                </div>
              </div>
              <div class="pt-3 px-2 txt-left of-x-scroll">
                <div @fadeIn class="box columns is-multiline" *ngIf="this.Produto?.Arte">
                  <a>Como essa arte será usada no produto?</a>
                  <div class="column">
                    <mat-card>
                      <mat-card-header>
                        <mat-card-subtitle>Frente</mat-card-subtitle>
                      </mat-card-header>
                      <figure class="image is-128x128">
                        <img mat-mat-card-image [src]="this.Produto?.Arte" height="200">
                      </figure>
                      <mat-card-actions>
                        <a mat-icon-button (click)="Produto.Arte = null">
                          <mat-icon>clear</mat-icon>
                        </a>
                      </mat-card-actions>
                    </mat-card>
                  </div>
                  <div @fadeIn *ngIf="Produto?.ArteSecundaria" class="column">
                    <mat-card>
                      <mat-card-header>
                        <mat-card-subtitle>Secundaria</mat-card-subtitle>
                      </mat-card-header>
                      <figure class="image is-128x128">
                        <img mat-mat-card-image [src]="this.Produto?.ArteSecundaria" height="200">
                      </figure>
                      <mat-card-actions>
                        <a mat-icon-button (click)="Produto.ArteSecundaria = null">
                          <mat-icon>clear</mat-icon>
                        </a>
                      </mat-card-actions>
                    </mat-card>
                  </div>
                </div>
                <div class="w-full">

                  <div class="pt-0">

                    <button class="w-full dis-flex flex-w flex-m" title="Gostei" matBadge="{{Produto?.Likes}}" matBadgeColor="accent" (click)="Like()" mat-icon-button [ngClass]="Liked? 'liked': ''" [ngClass]="loading ? 'button is-loading':''">
                      <p>
                        <mat-icon [ngClass]="Liked? 'liked': ''" class="heartbutton color-light-red">
                          {{Liked? 'favorite': 'favorite_border'}}</mat-icon>
                        </p>
                      </button>
                      <mat-chip-list  *ngIf="Liked" aria-label="Thanks">
                        <mat-chip color="primary" selected>Você curtiu este produto</mat-chip>
                      </mat-chip-list>
                  </div>
                </div>
                <mat-divider></mat-divider>

                <div class="mx-0 dis-flex flex-sa flex-m w-full columns is-multiline is-vcentered ">
                  <div class="column txt-center">
                    <h4 class="">Formas de pagamento</h4>
                    <img
                    loading="lazy"
                    src="https://imgmp.mlstatic.com/org-img/MLB/MP/BANNERS/tipo2_468X60.jpg?v=1"
                    alt="Mercado Pago - Meios de pagamento" title="Mercado Pago - Meios de pagamento"
                    width="468" height="60"
                    [style.height]="'60px !important'"
                    [style.width]="'468px !important'"
                    >
                  </div>

                </div>
              </div>

              <div class="columns w-full is-gapless is-multiline">
                <div class="column w-full is-12-mobile">
                  <button mat-raised-button (click)="EntrarEmContato()" routerLinkActive="router-link-active"
                    title="Entrar em contato pelo whatsapp"
                    class="button w-full is-success wp-btn border-light flex-m flex-c has-text-white has-text-weight-medium">
                    <fa-icon class="color-wp" [icon]="iconeWhatsapp" [size]="'lg'"></fa-icon>
                    <span class="ml-3 nunitoParagraphy16 has-text-white">Comprar pelo whatsapp</span>
                  </button>
                </div>
                <div class="column pt-0 mt-0 is-hidden-desktop">
                  <button mat-button [matMenuTriggerFor]="menu"><i class="pi pi-share-alt"></i></button>
                  <mat-menu #menu="matMenu">
                    <div mat-menu-item>
                      <share-button class="mt-3 hoverable" button="facebook" theme="modern-dark" [showText]="false">
                      </share-button>
                    </div>
                    <div mat-menu-item>
                      <share-button class="mt-3 hoverable" button="twitter" theme="modern-dark" [showText]="false">
                      </share-button>
                    </div>
                  </mat-menu>
                </div>
              </div>

            </div>
          </div>

          <figure class="image is-64x64 img-orcamento" [ngClass]="isOrcamento ? 'active' : ''">
            <img src="{{Produto?.Imagem[0]}}" alt="">
          </figure>
        </div>
        <div class="column is-5 mb-0 top-0 pt-3" >
          <!-- <mat-chip-list class="is-left">
                <mat-chip class="mx-1 py-1 px-6 is-capitalized">{{translateStatusProduto(Produto?.Status)}}</mat-chip>
              </mat-chip-list> -->
          <p-skeleton *ngIf="!Produto" styleClass="skeleton "></p-skeleton>

          <mat-tab-group headerPosition="below" [selectedIndex]="selected.value" (selectedIndexChange)="selected.setValue($event)">
            <mat-tab [label]="'Galeria'">
              <gallery gallerize id="myGallery" [ngClass]="mobile?'':''" *ngIf="galleryConfig$ | async; let config"
                [counter]="false" [nav]="false" [loadingStrategy]="'lazy'" [thumbWidth]="config.thumbWidth"
                [dots]="true"
                [thumbHeight]="config.thumbHeight" [thumbPosition]="config.thumbPosition">
              </gallery>
            </mat-tab>
          </mat-tab-group>

          <div class="column pt-0 mt-0 is-hidden-touch ">
            <button mat-button [matMenuTriggerFor]="menu2"><i class="pi pi-share-alt"></i></button>
            <mat-menu #menu2="matMenu">
              <div mat-menu-item>
                <share-button class="mt-3 hoverable" button="facebook" theme="modern-dark" [showText]="false">
                </share-button>
              </div>
              <div mat-menu-item>
                <share-button class="mt-3 hoverable" button="twitter" theme="modern-dark" [showText]="false">
                </share-button>
              </div>
            </mat-menu>
          </div>
          <mat-tab-group class="is-hidden-desktop">
            <mat-tab label="Informações">
              <div class="margin py-3 px-3 border-light">
                <div class="w-full columns ">
                  <h3>Descrição do produto</h3>
                  <div class="descricao-produto column is-6 w-full" [innerHTML]="(el?.innerHTML)"></div>
                  <h3>Especificações do produto</h3>
                  <div class="descricao-produto column is-6 w-full" style="border-left: 1px solid #0000000a;"
                    [innerHTML]="Produto?.Especificacoes || 'Este produto está sem especificações'"></div>
                </div>
              </div>

            </mat-tab>
            <mat-tab label="Avaliações">
              <div class="margin px-6 py-1 mb-6" *ngIf="Produto">
                <div class="z-index-2 px-2 py-2 my-6">
                  <div class="mx-2">
                    <div class="w-full">
                      <p>Você já tem este produto?</p>
                      <span class="subtitle is-size-7">Compartilhe a sua opinião com a gente.</span>
                    </div>
                    <p><strong>{{Comentarios?.length||0}} comentários</strong></p>
                    <personalizados-lopes-escrever-comentario (EnviarComentario)="this.Comentar($event)"></personalizados-lopes-escrever-comentario>
                  </div>
                </div>
                <personalizados-lopes-exibir-lista-comentario-produto [Comentarios]="ComentariosProduto"></personalizados-lopes-exibir-lista-comentario-produto>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>

      </div>
      <mat-tab-group class="is-hidden-touch">
        <mat-tab label="Informações" (click)="AdicionarDescricao()">
          <div class="has-background-white py-3 px-3 border-light">
            <div class="w-full columns is-multiline">
              <h3>Descrição do produto</h3>
              <div class="descricao-produto column is-12 " style="border-left: 1px solid #0000000a;"
                [innerHTML]="Produto?.Especificacoes || 'Este produto está sem especificações'"></div>
              <div class="descricao-produto column is-12 " [innerHTML]="(el?.innerHTML)"></div>
            </div>
          </div>

        </mat-tab>
        <mat-tab label="Avaliações">
          <div class="margin px-6 py-1 mb-6" *ngIf="Produto">
            <div class="z-index-2 px-2 py-2 my-6">
              <div class="mx-2">
                <div class="w-full">
                  <p>Você já tem este produto?</p>
                  <span class="subtitle is-size-7">Compartilhe a sua opinião com a gente.</span>
                </div>
                <p><strong>{{Comentarios?.length||0}} comentários</strong></p>
                <personalizados-lopes-escrever-comentario (EnviarComentario)="this.Comentar($event)"></personalizados-lopes-escrever-comentario>
              </div>
            </div>
            <personalizados-lopes-exibir-lista-comentario-produto [Comentarios]="ComentariosProduto"></personalizados-lopes-exibir-lista-comentario-produto>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>

</div>

<div class="w-full flex-w flex-sa px-6 my-2">
  <a [routerLink]="'/produtos'" class="has-text-grey">
    <button mat-icon-button>
      <mat-icon>chevron_left</mat-icon>
    </button>
  </a>
  <a [routerLink]="'/showcase'" class="has-text-grey">
    <button mat-icon-button>
      <mat-icon>collections</mat-icon>
    </button>
  </a>
</div>

<div class="bg-transp margin txt-center">

  <div class=" px-6 py-6 mb-3" *ngIf="Produto?._id">
    <personalizados-lopes-tag-produto-swiper [TAGS]="Produto?.Tags"></personalizados-lopes-tag-produto-swiper>
  </div>

  <mat-divider></mat-divider>

  <div class="  mb-3" *ngIf="Produto?._id">
    <personalizados-lopes-produto-swiper class="z-index-1" [TipoOrdenacao]="tipoOrdenacaoSliderProduto.Visualizacoes">
    </personalizados-lopes-produto-swiper>
  </div>

  <mat-divider></mat-divider>

  <div class="">
    <personalizados-lopes-exibir-lista-comentario-produto [Comentarios]="ComentariosProduto"></personalizados-lopes-exibir-lista-comentario-produto>

  </div>

  <div class=" ">
    <personalizados-lopes-blog-swiper [TAGS]="Produto?.Tags"></personalizados-lopes-blog-swiper>
  </div>

  <personalizados-lopes-loading-cube *ngIf="redirecionando" [Mensagem]="'Redirecionando para checkout'">
  </personalizados-lopes-loading-cube>


</div>
